- name: Alta proceso Connect Direct
  become: yes
  become_user: ndm36
  become_method: su
  become_exe: sudo su -
  shell: |
      /NDM36/depura/stopcd.sh
      sleep 10

- name: Validar proceso Connect Direct
  shell: |
      if [ $(ps -eo args | grep -v grep | egrep -w "cdpmgr|cdstatm" | wc -l) -eq 0 ]
      then
      echo INACTIVO
      elif [ $(ps -eo args | grep -v grep | egrep -w "cdpmgr|cdstatm" | wc -l) -eq 1 ]
      then
      echo "INACTIVACION_FALLDA"
      fi  
  register: statuscd

- name: Resultado de la alta del proceso Connrect Direct
  debug:
    msg:
       - "ConnectDirect ........{{ statuscm.stdout }}"
  when: statuscd.stdout == "INACTIVO"
  
- name: Resultado de la alta del proceso Connrect Direct
  fail:
    msg:
       - "ConnectDirect ........{{ statuscm.stdout }}"
       - "No se pudo INACTIVAR de forma correcta"
       - "Escalar con el Ã¡rea de InfraUnix"
  when: statuscd.stdout == "INACTIVACION_FALLDA"
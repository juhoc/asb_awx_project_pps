- name: Validar proceso CapacityAgent
  shell: |
      if [ $(ps -eo args | grep -v grep | egrep "bgsagent|bgscollect|bgssd" | wc -l) -eq 3 ]
      then
      echo ACTIVO
      elif [ $(ps -eo args | grep -v grep | egrep "bgsagent|bgscollect|bgssd" | wc -l) -eq 0 ]
      then
      echo INACTIVO
      elif [ $(ps -eo args | grep -v grep | egrep "bgsagent|bgscollect|bgssd" | wc -l) -eq 1 ]
      then
      echo VALIDACION_FALLIDA
      elif [ $(ps -eo args | grep -v grep | egrep "bgsagent|bgscollect|bgssd" | wc -l) -eq 2 ]
      then
      echo VALIDACION_FALLIDA
      fi
  register: statusca
  
- name: Resultado de la validacion del proceso CapacityAgent
  debug:
    msg:
       - "CapacityAgent ........{{ statusca.stdout }}"
  when: statusca.stdout == "ACTIVO" or statusca.stdout == "INACTIVO"
  
- name: Resultado de la validacion del proceso CapacityAgent
  fail:
    msg:
       - "CapacityAgent ........{{ statusca.stdout }}"
       - "No todos los procesos estan ACTIVOS"
       - "Escalar con el Ã¡rea de RTMonitoreo"
  when: statusca.stdout == "VALIDACION_FALLIDA"
